import /vendor/etc/init/init.hisi.usb.rc


on early-init
    # Set the security context of /postinstall if present.
    restorecon /postinstall
    # Set init and its forked children's oom_adj.
    write /proc/1/oom_score_adj -1000
    write /proc/sys/kernel/sysrq 0
    restorecon /adb_keys
    mkdir /mnt 0775 root system
    start ueventd

on init
    export ANDROID_ROOT /system
    export ANDROID_DATA /data
    export EXTERNAL_STORAGE /sdcard
    sysclktz 0

    copy /proc/cmdline /dev/urandom
    copy /default.prop /dev/urandom
    symlink /system/etc /etc
    symlink /sys/kernel/debug /d
    mkdir /config 0500 root root

    write /proc/sys/kernel/panic_on_oops 1
    write /proc/sys/vm/max_map_count 1000000
    symlink /system/vendor /vendor
    chown system system /dev/cpuctl
    chown system system /dev/cpuctl/tasks

    #oem_info
    write /sys/module/hisi_nve/parameters/nve /dev/block/by-name/nvme
    wait /dev/nve0
    chmod 0640 /dev/nve0
    chown root system /dev/nve0

    #ddr freq
    chown system system /sys/class/devfreq/ddrfreq/max_freq
    chmod 664 /sys/class/devfreq/ddrfreq/max_freq
    chown system system /sys/class/devfreq/ddrfreq/min_freq
    chmod 664 /sys/class/devfreq/ddrfreq/min_freq

    # Mount cgroup mount point for cpu accounting
    mount cgroup none /acct cpuacct
    mkdir /acct/uid

#init.rc
on charger
    mount_all /vendor/etc/fstab.${ro.hardware}
    
    chmod 0660 /sys/class/hw_power/interface/enable_charger
    chown system system /sys/class/hw_power/interface/enable_charger
    chmod 0660 /sys/class/hw_power/charger/charge_data/iin_thermal
    chown system system /sys/class/hw_power/charger/charge_data/iin_thermal
    chmod 0660 /sys/class/hw_power/charger/direct_charger/enable_charger
    chown system system /sys/class/hw_power/charger/direct_charger/enable_charger
    chmod 0660 /sys/class/hw_power/charger/direct_charger/iin_thermal
    chown system system /sys/class/hw_power/charger/direct_charger/iin_thermal
    chmod 0660 /sys/class/hw_power/charger/direct_charger/adaptor_voltage
    chown system system /sys/class/hw_power/charger/direct_charger/adaptor_voltage

    chmod 0660 /sys/class/hw_power/charger/direct_charger_sc/enable_charger
    chown system system /sys/class/hw_power/charger/direct_charger_sc/enable_charger
    chmod 0660 /sys/class/hw_power/charger/direct_charger_sc/iin_thermal
    chown system system /sys/class/hw_power/charger/direct_charger_sc/iin_thermal
    chmod 0660 /sys/class/hw_power/charger/direct_charger_sc/set_resistance_threshold
    chown system system /sys/class/hw_power/charger/direct_charger_sc/set_resistance_threshold
    chmod 0660 /sys/class/hw_power/charger/direct_charger_sc/set_chargetype_priority
    chown system system /sys/class/hw_power/charger/direct_charger_sc/set_chargetype_priority

    chmod 0660 /sys/class/hw_power/charger/wireless_sc/enable_charger
    chown system system /sys/class/hw_power/charger/wireless_sc/enable_charger
    chmod 0660 /sys/class/hw_power/charger/wireless_sc/iin_thermal
    chown system system /sys/class/hw_power/charger/wireless_sc/iin_thermal

    chmod 0660 /sys/class/hw_power/charger/charge_data/cca_charge_pattern
    chown system system /sys/class/hw_power/charger/charge_data/cca_charge_pattern
    chmod 0660 /sys/class/hw_power/charger/charge_data/cca_cccv_sample
    chown system system /sys/class/hw_power/charger/charge_data/cca_cccv_sample

    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor interactive
    restorecon_recursive /sys/devices/system/cpu/cpu0/cpufreq/interactive
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/hispeed_freq 807000
    chown system system /sys/class/android_usb/android0/switch_request
    chmod 0664 /sys/class/android_usb/android0/switch_request

    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor powersave
    write /sys/kernel/set_hmp_thresholds/enable 0
    write /sys/kernel/hmp/up_threshold 1020
    write /sys/kernel/hmp/down_threshold 768
    write /sys/kernel/set_hmp_thresholds/enable 1
    write /sys/kernel/eas/boot_boost 0

    write /sys/class/devfreq/ddrfreq/min_freq 0
    write /sys/class/devfreq/ddrfreq/max_freq 0
    write /sys/class/devfreq/ddrfreq_latency/min_freq 0
    write /sys/class/devfreq/ddrfreq_latency/max_freq 0
    write /sys/class/devfreq/ddrfreq_up_threshold/max_freq 933000000
    write /sys/class/devfreq/ddrfreq_up_threshold/min_freq 933000000

    class_start charger

    wait /dev/block/bootdevice/by-name/oeminfo
    start oeminfo_nvm
    start teecd

    chmod 0660 /sys/devices/virtual/hw_power/power_mesg/powerct
    chown system system /sys/devices/virtual/hw_power/power_mesg/powerct
    chmod 0660 /sys/devices/virtual/hw_power/power_mesg/runtime
    chown system system /sys/devices/virtual/hw_power/power_mesg/runtime
    chmod 0440 /sys/devices/platform/huawei_batt_info/ic_id
    chown system system /sys/devices/platform/huawei_batt_info/ic_id
    chmod 0440 /sys/devices/platform/huawei_batt_info/batt_id
    chown system system /sys/devices/platform/huawei_batt_info/batt_id
    chmod 0440 /sys/devices/platform/huawei_batt_info/ic_status
    chown system system /sys/devices/platform/huawei_batt_info/ic_status
    chmod 0440 /sys/devices/platform/huawei_batt_info/sn_status
    chown system system /sys/devices/platform/huawei_batt_info/sn_status
    chmod 0440 /sys/devices/platform/huawei_batt_info/key_status
    chown system system /sys/devices/platform/huawei_batt_info/key_status
    chmod 0440 /sys/devices/platform/huawei_batt_info/official
    chown system system /sys/devices/platform/huawei_batt_info/official

    start powerct
    start atcmdserver
    start bsoh


service charger /system/bin/charger
    class charger
    user root
    group root system
    critical
    seclabel u:r:charger:s0

# /* mount decrypt data */
on property:vold.decrypt=trigger_default_encryption
    start defaultcrypto

on nonencrypted
    trigger data_ready

on data_ready
    setprop sys.userdata_is_ready 1
#    start chargemonitor

on post-fs-data
    setprop vold.post_fs_data_done 1

on property:vold.decrypt=trigger_restart_framework
    trigger data_ready

on property:vold.decrypt=trigger_post_fs_data
    trigger post-fs-data


service defaultcrypto /system/bin/vdc --wait cryptfs mountdefaultencrypted
    disabled
    oneshot

# /*The service, trigger, persist  associated with the log */
#service chargemonitor /system/bin/chargemonitor
#    class late_start
#    user system
#    group system
#    oneshot
#    seclabel u:r:chargemonitor:s0


